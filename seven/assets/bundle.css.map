{
  "version": 3,
  "file": "bundle.css",
  "sources": [
    "../../src/components/Main.svelte",
    "../../src/components/Opcao.svelte"
  ],
  "sourcesContent": [
    "<script>\n  import { onMount } from 'svelte';\n  import querystring from 'query-string';\n\n  import Opcao from './Opcao.svelte';\n  import FormSearch from './FormSearch.svelte';\n  import {\n    fetchApi,\n    formatData,\n  } from '../utils';\n\n  let QTD_FETCH = 250;\n\n  let totalOpcoes = 0;\n  let loading = false;\n  let opcoes = [];\n  let stockName = '';\n  let stockMonth = '';\n  let minNegociosBiggerThan = 0;\n\n  const searchParams = {\n    tipo: 'venda',\n    qtd: QTD_FETCH,\n    inicio: 0,\n  };\n\n  const runTimeoutOpcoes = async (initDoc = 0) => {\n    console.log('runTimeoutOpcoes');\n    searchParams.inicio = initDoc;\n    searchParams.mes = stockMonth;\n    searchParams.acao = stockName;\n    const path = `/opcoes/completo?${querystring.stringify(searchParams)}`;\n    console.log('searchParams', searchParams);\n\n    const res = await fetchApi(path);\n    // console.log('res', res);\n    opcoes = [...opcoes, ...res];\n\n    if ((initDoc + QTD_FETCH) <= totalOpcoes) {\n      setTimeout(() => {\n        runTimeoutOpcoes(initDoc + QTD_FETCH);\n      }, 1000);      \n    } else {\n      loading = false;\n      console.log('busca finalizada')\n    }\n  };\n\n  const getOpcoes = async (form) => {\n    stockName = form.stockName || '';\n    stockMonth = form.stockMonth || '';\n    minNegociosBiggerThan = form.minNegociosBiggerThan || 0;\n\n    const params = {\n      tipo: form.type || 'venda',\n      mes: stockMonth,\n      acao: stockName,\n    };\n\n    console.log('getOpcoes');\n    console.log('params', params);\n\n    const res = await fetchApi(`/opcoes/total?${querystring.stringify(params)}`);\n    totalOpcoes = res[0].total;\n\n    opcoes = [];\n    loading = true;\n    searchParams.tipo = params.tipo;\n\n    runTimeoutOpcoes();\n  };\n\n</script>\n\n<style>\n  .container {\n    padding: 20px;\n    margin: 0 auto;\n    max-width: 800px;\n    border: 1px solid #dedede;\n  }\n\n  .filter {\n    margin-top: 20px;\n    font-size: 12px;\n    font-weight: bold;\n  }\n\n  h3 {\n    font-size: 12px;\n    margin-top: 20px;\n    font-weight: bold;\n  }\n\n  .list {\n    margin-top: 25px;\n  }\n\n  .list .hide {\n    display: none;\n  }\n</style>\n\n<div class=\"container\">\n  <FormSearch onGetOpcoes={getOpcoes} />\n\n  <h3>\n    Status:\n    {#if loading}\n      Carregando opções... Total de { totalOpcoes } / Opções carregadas: { opcoes.length }\n    {:else if !loading && opcoes.length}\n      Lista carregada :) - Total de opções carregadas: { opcoes.length }\n    {:else}\n      Aguardando iniciar a busca\n    {/if}\n  </h3>\n\n  <ul class=\"list\">\n    {#each opcoes as opcao, index}\n      <li>\n        <Opcao\n          key={`opcao-${index}`}\n          opcao={opcao}\n          minNegociosBiggerThan={minNegociosBiggerThan}\n        />\n      </li>\n    {/each}\n  </ul>\n</div>\n",
    "<script>\n  import { onMount } from 'svelte';\n\n  import Chart from './Chart.svelte';\n  import {\n    formatData,\n    formatToNumber,\n    formatToMoney,\n  } from '../utils';\n\n  export let opcao;\n  export let key;\n  export let minNegociosBiggerThan = 0;\n  let open = false;\n  let totalHistory = 0;\n\n  const toggle = () => {\n    open = !open;\n  };\n\n  const openCard = () => {\n    // abre card caso tiver histórico maior que 3 itens &&\n    // se histórico tiver negócios maior que valor mínimo\n\n    let countValidHistory = 0;\n    let hasNegociosBiggerThan = false;\n\n    opcao.historico.forEach((item) => {\n      if (item.fechamento) {\n        countValidHistory++;\n      }\n\n      if (item.quantidade >= parseInt(minNegociosBiggerThan)) {\n        hasNegociosBiggerThan = true;\n      }\n    });\n\n    if (countValidHistory > 2 && hasNegociosBiggerThan) {\n      open = true;\n    }\n  };\n\n  const getDataChart = (history, key) => {\n    const data = history.map((item) => {\n      return item[key];\n    });\n    return data;\n  };\n\n  const getLabelChart = (history) => {\n    const dates = history.map((item) => {\n      return formatData(item.data);\n    });\n    return dates;\n  };\n\n  const getTooltipChart = (history, type) => {\n    return {\n      callbacks: {\n        label: (tooltipItem, data) => {\n          let label = data.datasets[tooltipItem.datasetIndex].label || '';\n\n          if (label) {\n            label += ': ';\n          }\n\n          label += type === 'price' ? formatToMoney(tooltipItem.yLabel) : formatToNumber(tooltipItem.yLabel);\n\n          return label;\n        },\n      },\n    };\n  };\n\n  const getDatasetChart = (history, type) => {\n    if (type === 'price') {\n      return [{\n        data: getDataChart(history, 'fechamento'),\n        type: 'line',\n        label: 'Preço',\n        lineTension: 0,\n        borderWidth: 1,\n        backgroundColor: 'rgba(255, 99, 132, 0.2)',\n        borderColor: 'rgba(255, 99, 132, 1)',\n      }];\n    }\n\n    return [{\n      data: getDataChart(history, 'quantidade'),\n      type: 'bar',\n      label: 'Quantidade',\n      borderWidth: 1,\n      backgroundColor: 'rgba(0, 0, 0, 0.2)',\n      borderColor: '#8c8a8a',\n    }];\n  };\n\n  onMount(() => {\n\n    openCard();\n\n  });\n\n</script>\n\n<style>\n  .container {\n    font-size: 13px;\n    padding: 5px 20px;\n    border: 1px solid #eee;\n  }\n\n  .container.active {\n    border-color: #5105e4;\n  }\n\n  .header {\n    color: #8e8e94;\n    display: flex;\n    cursor: pointer;\n    font-weight: bold;\n    justify-content: space-between;\n  }\n\n  .header.active {\n    color: #5105e4;\n  }\n\n  .chart {\n    margin-top: 20px;\n  }\n</style>\n\n<div class=\"container\" class:active=\"{open === true}\">\n  <div class=\"header\" class:active=\"{open === true}\" on:click={toggle}>\n    <strong>{opcao.codigo} ({opcao.acao})</strong>\n    <strong>Preço: {opcao.preco}</strong>\n    <strong>Vencimento: {opcao.vencimento}</strong>\n  </div>\n\n  {#if open}\n    <div class=\"chart\">\n      <Chart\n        key={`chart-${key}-1`}\n        datasets={getDatasetChart(opcao.historico, 'price')}\n        labels={getLabelChart(opcao.historico)}\n        tooltips={getTooltipChart(opcao.historico, 'price')}\n      />\n      <Chart\n        key={`chart-${key}-2`}\n        datasets={getDatasetChart(opcao.historico, 'volume')}\n        labels={getLabelChart(opcao.historico)}\n        tooltips={getTooltipChart(opcao.historico, 'volume')}\n      />\n    </div>\n  {/if}\n</div>\n"
  ],
  "names": [],
  "mappings": "AA2EE,UAAU,eAAC,CAAC,AACV,OAAO,CAAE,IAAI,CACb,MAAM,CAAE,CAAC,CAAC,IAAI,CACd,SAAS,CAAE,KAAK,CAChB,MAAM,CAAE,GAAG,CAAC,KAAK,CAAC,OAAO,AAC3B,CAAC,AAQD,EAAE,eAAC,CAAC,AACF,SAAS,CAAE,IAAI,CACf,UAAU,CAAE,IAAI,CAChB,WAAW,CAAE,IAAI,AACnB,CAAC,AAED,KAAK,eAAC,CAAC,AACL,UAAU,CAAE,IAAI,AAClB,CAAC;ACUD,UAAU,eAAC,CAAC,AACV,SAAS,CAAE,IAAI,CACf,OAAO,CAAE,GAAG,CAAC,IAAI,CACjB,MAAM,CAAE,GAAG,CAAC,KAAK,CAAC,IAAI,AACxB,CAAC,AAED,UAAU,OAAO,eAAC,CAAC,AACjB,YAAY,CAAE,OAAO,AACvB,CAAC,AAED,OAAO,eAAC,CAAC,AACP,KAAK,CAAE,OAAO,CACd,OAAO,CAAE,IAAI,CACb,MAAM,CAAE,OAAO,CACf,WAAW,CAAE,IAAI,CACjB,eAAe,CAAE,aAAa,AAChC,CAAC,AAED,OAAO,OAAO,eAAC,CAAC,AACd,KAAK,CAAE,OAAO,AAChB,CAAC,AAED,MAAM,eAAC,CAAC,AACN,UAAU,CAAE,IAAI,AAClB,CAAC"
}